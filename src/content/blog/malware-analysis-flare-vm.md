---
title: "Behavioral Analysis Report: Reverse HTTPS Meterpreter Stager"
description: "A technical deep dive into identifying behavioral Indicators of Compromise (IoCs) for a framework-generated reverse shell payload."
pubDate: "Jan 10 2026"
tags: ["malware", "analysis", "flare-vm", "blue-team"]
heroImage: "/images/MalwareAnalysisFlareVM/24_virustotal_result.png"
---

# Behavioral Analysis Report: Reverse HTTPS Meterpreter Stager

## Executive Summary

This report analyzes a framework-generated reverse shell payload to identify behavioral Indicators of Compromise (IoCs). The goal was to map the attack lifecycle, from initial infection to Command & Control (C2) establishment, and identify reliable artifacts for detection. By emulating standard adversary techniques, this assessment provides actionable intelligence for improving endpoint security posture and network visibility.

### Assessment Scope

1. **Adversary Emulation**: Utilizing a standard payload to generate a behavioral footprint for analysis.
2. **Behavioral Triage**: Monitoring process, registry, and file system activity in a hardened Flare-VM environment.
3. **Network Forensics**: Analyzing encrypted C2 traffic patterns and protocol anomalies.
4. **IoC Identification**: Documenting static and dynamic indicators to improve host-based detection.

### Methodology

The analysis was conducted using **Dynamic Analysis** within an isolated **Flare-VM** instance. This approach provides high-fidelity visibility into system changes in real-time, allowing for the correlation of network traffic with underlying process behavior without the OpSec risks associated with public sandboxes.

---

## Adversary Emulation & Simulation

To generate a predictable behavioral footprint, I utilized a standard payload generated via MSFVenom. This provides a baseline for understanding how common automated threats interact with Windows systems.

### Simulation Initialization

The payload development utilized **MSFVenom** to generate a staged executable.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/01_msfvenom_list_payloads.png" width="80%" />
  <br>
  <i>Figure 1: MSFVenom payload framework enumeration</i>
</p>

### Payload Selection

The selected payload is `windows/meterpreter/reverse_https`. This stager is frequently employed by threat actors to establish interactive C2 via HTTPS, effectively blending in with legitimate web traffic and evading simple protocol-based firewall rules.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/02_selected_payload.png" width="80%" />
  <br>
  <i>Figure 2: Stager selection for simulation</i>
</p>

### Infrastructure Configuration

The simulation environment was configured with the following parameters to ensure isolated yet realistic connectivity:

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/04_host_ip_address.png" width="80%" />
  <img src="/images/MalwareAnalysisFlareVM/05_vm_ip_address.png" width="80%" />
  <br>
  <i>Figure 3: Isolated Network Configuration - (Left) C2 Listener, (Right) Analysis Node</i>
</p>

The final payload was compiled as `ysrdh.exe`, representing a targeted binary aimed at the analysis environment.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/06_saving_malware.png" width="80%" />
  <br>
  <i>Figure 4: Payload compilation for adversary emulation</i>
</p>

---

## Execution & Behavioral Analysis

Following payload deployment, the simulation transitioned to the execution phase to monitor host-based interactions.

### Ingress Vector & Delivery

To simulate a realistic web-based delivery vector, the payload was hosted via a Python HTTP server. This method replicates a "drive-by download" or social engineering scenario where a victim is coerced into downloading a malicious executable.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/11_serving_the_file_via_http_server.png" width="80%" />
  <br>
  <i>Figure 5: Simulating web-based payload delivery</i>
</p>

Upon retrieval, Windows Defender flagged the artifact, requiring manual intervention to permit execution—a common friction point where adversaries employ social engineering or obfuscation to bypass user warnings.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/17_downloaded_file.png" width="60%" />
  <br>
  <i>Figure 6: Payload successfully staged on the target endpoint</i>
</p>

### C2 Infrastructure Preparation

A multi-handler listener was established on the C2 node, mimicking a standard adversary's listening post.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/07_search_exploit_multi_handler_msfconsole.png" width="80%" />
  <br>
  <i>Figure 7: Establishing the C2 listening post</i>
</p>

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/09_use_exploit_and_set_payload.png" width="80%" />
  <img src="/images/MalwareAnalysisFlareVM/10_set_options_msfconsole.png" width="80%" />
  <br>
  <i>Figure 8: Listener configuration for HTTPS C2</i>
</p>

### Post-Exploitation Triage

Upon execution, the payload successfully established an encrypted HTTPS tunnel. Initial triage focused on process migration, a common technique for achieving persistence and evading simple process-based monitoring.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/19_System_Info_Meterpreter.png" width="80%" />
  <img src="/images/MalwareAnalysisFlareVM/20_shell.png" width="80%" />
  <br>
  <i>Figure 9: Initial C2 interaction and system fingerprinting</i>
</p>

The payload was observed migrating to a 32-bit (x86) process to ensure compatibility and stability within the target architecture.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/23_migrate_success.png" width="80%" />
  <br>
  <i>Figure 10: Defense Evasion: Successful process migration</i>
</p>

---

## Deep Dive: Static & Cloud-Based Analysis

### Static Indicators & Anomaly Detection

Initial static triage revealed critical anomalies in the binary's structure. Manual inspection of the PE headers (verified later via cloud-based correlation) identified the `.nyhl` section.

Legitimate Windows binaries rarely contain non-standard section names. The presence of a randomized 4-character section is a high-confidence indicator of a packed or obfuscated payload, likely generated by an automated framework.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/24_virustotal_result.png" width="90%" />
  <br>
  <i>Figure 11: Initial triage and reputation correlation</i>
</p>

#### Operational Security (OpSec) Failures
Analysis of the file metadata revealed significant OpSec failures by the "adversary":
1.  **"Patient Zero" Indicator**: The *First Submission* and *Last Submission* timestamps were identical, indicating a fresh sample with no global prevalence.
2.  **Naming Convention**: The binary retained the name `ysrdh.exe` without attempting to masquerade as a legitimate system utility (e.g., `svchost.exe` or `update.exe`), making it trivial to spot in process listings.
3.  **File Size Anomaly**: At approximately 7.5KB, the file is suspiciously small for a functional Windows application, aligning with the profile of a *stager* or shellcode runner.

### Technical Fact: Compilation Artifacts as IoCs

A significant finding was the compilation timestamp: `2025-08-28`. This date precedes the actual deployment by several months. Technical investigation reveals that this is a "Static IoC" characteristic of the Metasploit template binary. Detecting this specific timestamp across a fleet can help identify generated payloads before they are even executed.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/40_virustotal_details.png" width="90%" />
  <br>
  <i>Figure 12: Metadata analysis identifying template-based generation</i>
</p>

### API Telemetry & Heuristics (Jujubox Analysis)

Dynamic analysis via Jujubox Sandbox highlighted specific API calls that serve as behavioral signatures for this stager:

1.  **Fingerprinting**: `GetAdaptersAddresses` calls are used to survey network interfaces, often to detect virtualized environments or bind listeners.
2.  **Anti-Analysis**: Usage of `GetTickCount` and `GetTickCount64` allows the malware to measure execution time, potentially identifying debuggers that slow down processing.
3.  **Concurrency Control**: `CreateMutexA` ensures only a single instance of the payload runs, preventing conflict or race conditions.
4.  **Native API Interaction**: Direct calls to `Nt*` functions (Native API) indicate an attempt to bypass user-mode hooks often placed by standard security products.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/44_virustotal_jujubox.png" width="90%" />
  <br>
  <i>Figure 13: Sandbox telemetry revealing API call sequences</i>
</p>

### Behavioral Patterns (YARA Correlation)

The payload triggered several behavior-based YARA rules, including `Windows_Trojan_Metasploit` and `INDICATOR_SUSPICIOUS_EXE_NoneWindowsUA`. The latter is particularly valuable for detection, as it flags the spoofed User-Agent used during C2 negotiation.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/45_virustotal_yara_rules.png" width="90%" />
  <br>
  <i>Figure 14: Pattern matching identifying framework-specific DNA</i>
</p>

---

## Host & Network Monitoring

### Process Lifecycle (Procmon & Wireshark)

Real-time monitoring using **Process Monitor** captured the payload's attempt to modify the system's `ZoneMap` registry keys, a classic defense evasion tactic used to lower internet security zones.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/29_running_wireshark.png" width="90%" />
  <br>
  <i>Figure 15: Capturing C2 heartbeat traffic on port 8080</i>
</p>

#### Technical Note: Tooling Interoperability
During analysis, a compatibility issue was noted between *Process Monitor* and *ProcDot*. Default CSV exports from Procmon lack the "Thread ID" field required by ProcDot for graph generation. Enabling this column is a critical prerequisite for successful visualization.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/35_procmon_error_format.png" width="70%" />
  <br>
  <i>Figure 16: Resolving tool interoperability issues for visualization</i>
</p>

### Advanced Visualization (ProcDot)

By correlating Procmon CSV logs with Wireshark PCAP data, I reconstructed the full execution graph. This visualization highlights the interaction between the suspicious process and the network sockets, providing a clear map of the infection lifecycle.

<p align="center">
  <img src="/images/MalwareAnalysisFlareVM/graph.png" width="90%" />
  <br>
  <i>Figure 17: Correlation Graph: Process, Registry, and Network Socket interaction</i>
</p>

### Environmental Artifacts
The analysis identified a connection attempt to `192.168.56.1`. This IP address is the default gateway for the VirtualBox Host-Only adapter. While intended to prevent leakage onto the public internet, this artifact definitively identifies the sample as a lab-generated binary, limiting its viability in the wild.

---

## Attack Timeline Reconstruction

Based on the dynamic analysis results, the following timeline reconstructs the attack chain from initial access to persistence.

| Phase | Actor | Action | Observable / IoC |
| :--- | :--- | :--- | :--- |
| **1. Initial Access** | `Explorer.EXE` | Process Creation | User executes `ysrdh.exe` from Downloads. |
| **2. Defense Evasion** | `ysrdh.exe` | Registry Modification | Modifies `ZoneMap` to degrade zone security settings. |
| **3. C2 Beaconing** | `ysrdh.exe` | Network Connection | Outbound TCP connection to `192.168.56.1:8080`. |
| **4. Instability** | `WerFault.exe` | File Activity | Crash report generation, indicating potential instability in the stager. |
| **5. Persistence** | `DllHost.exe` | Network Connection | Active C2 channel observed from a legitimate system process (after migration). |

---

## Strategic Retrospective

This simulation underscores a critical reality in modern cyber defense: **static evasion is temporary, but behavior is permanent**. While the `ysrdh.exe` payload was intentionally "noisy" and easily flagged by static signatures (time-stomping anomalies, default Metasploit templates), its execution phase successfully emulated techniques used by sophisticated APTs—specifically process migration and registry manipulation.

For Blue Teams, the value of this analysis lies not in dissecting a known commodity like Meterpreter, but in validating the defensive telemetry required to catch it. If a security stack relies solely on file reputation, it fails against a custom-compiled variant of this same stager. However, a defense-in-depth strategy focused on **behavioral anomalies**—such as `explorer.exe` spawning network connections or unauthorized modifications to `ZoneMap` keys—remains resilient regardless of the payload's origin.

### Critical Defense Takeaways

1. **Shift Left to Behavior**: Static signatures are fragile. Detection logic must pivot to behavioral indicators, such as identifying processes like `notepad.exe` or `calc.exe` initiating high-entropy network connections.
2. **Hardening the Registry**: The modification of `Internet Settings\ZoneMap` is a high-fidelity indicator of compromise. Implementing strict EDR rules to block or alert on changes to these keys can neutralize drive-by download vectors early in the kill chain.
3. **Network Invisibility is a Myth**: Even encrypted C2 channels leave a fingerprint. Deploying JA3/JA3S profiling allows defenders to identify the underlying tooling (e.g., Metasploit, Cobalt Strike) based on the TLS handshake, rendering SSL/TLS encryption less effective as a cloaking mechanism.